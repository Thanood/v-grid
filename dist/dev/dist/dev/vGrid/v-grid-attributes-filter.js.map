{"version":3,"sources":["vGrid/v-grid-attributes-filter.js"],"names":[],"mappings":"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","file":"vGrid/v-grid-attributes-filter.js","sourceRoot":"/source/","sourcesContent":["/*****************************************************************************************************************\r\n *    Attributes for header so users can add to headers to activate filtering\r\n *    Created by vegar ringdal\r\n *\r\n ****************************************************************************************************************/\r\nimport {inject, customAttribute} from 'aurelia-framework';\r\nimport {VGrid} from './v-grid';\r\n\r\n\r\n@customAttribute('v-filter')\r\n@inject(Element, VGrid)\r\nexport class vGridAttributesFilter {\r\n\r\n  constructor(element, vGrid) {\r\n    this.vGrid = vGrid;\r\n    this.element = element;\r\n  }\r\n\r\n\r\n  get valueConverters() {\r\n    if (this.vGrid) {\r\n      return this.vGrid.viewResources.lookupFunctions.valueConverters;\r\n    }\r\n  }\r\n\r\n\r\n  bind(bindingContext, overrideContext) {\r\n    this.bindingContext = bindingContext;\r\n    this.overrideContext = overrideContext;\r\n\r\n    //splitt options\r\n    let values = this.value.split(\"|\");\r\n\r\n    //get attribute\r\n    this.attribute = values[0].trim();\r\n\r\n    //loop values and find out what options are\r\n    if (values.length > 1) {\r\n      values.forEach((value, i)=> {\r\n        if (i !== 0) {\r\n          this.checkParams(value)\r\n        }\r\n      });\r\n    }\r\n\r\n    this.filterOn = this.filterOn || \"onEnterKey\";\r\n    this.filterOperator = this.filterOperator || \"=\";\r\n    this.valueFormater = this.valueFormater || null;\r\n    this.type = this.element.type;\r\n    this.state = 0;\r\n\r\n  }\r\n\r\n\r\n  checkParams(value) {\r\n\r\n    if (value !== undefined && value !== null) {\r\n      value = value.trim();\r\n    }\r\n\r\n    let valueConverter = this.valueConverters(value);\r\n    if (valueConverter) {\r\n      this.valueFormater = valueConverter;\r\n    }\r\n\r\n    let filterOperator = this.vGrid.vGridFilter.filterOperatorTableString[value];\r\n    if (filterOperator) {\r\n      this.filterOperator = value;\r\n    }\r\n\r\n    if (value === \"onKeyDown\") {\r\n      this.filterOn = value;\r\n    }\r\n\r\n\r\n  }\r\n\r\n\r\n  getValue() {\r\n    if (this.type !== \"checkbox\") {\r\n      return this.valueFormater ? this.valueFormater.fromView(this.element.value) : this.element.value;\r\n    } else {\r\n      return this.state ? this.state === 2 ? true : false : \"\";\r\n    }\r\n  }\r\n\r\n\r\n  resetValue() {\r\n    if (this.type !== \"checkbox\") {\r\n      this.element.value = \"\";\r\n    } else {\r\n      this.state = 0;\r\n      this.element.checked = false;\r\n    }\r\n  }\r\n\r\n\r\n  updateFilter(curFilter) {\r\n    var filterIndex = null;\r\n\r\n    //get index of filter\r\n    curFilter.forEach((filter, index)=> {\r\n      if (filter.attribute === this.attribute) {\r\n        filterIndex = index;\r\n      }\r\n    });\r\n\r\n    if (filterIndex !== null) {\r\n\r\n      //we found a filter, lets update\r\n      if (this.getValue() === \"\") {\r\n        curFilter.splice(filterIndex, 1)\r\n      } else {\r\n        curFilter[filterIndex].value = this.getValue();\r\n        curFilter[filterIndex].operator = this.filterOperator;\r\n      }\r\n\r\n    } else {\r\n\r\n      //we didnt find filter, lets add one\r\n      if (this.getValue() !== \"\") {\r\n        curFilter.push({\r\n          attribute: this.attribute,\r\n          operator: this.filterOperator,\r\n          value: this.getValue()\r\n        });\r\n      }\r\n\r\n    }\r\n  }\r\n\r\n\r\n  attached() {\r\n\r\n    if (this.attribute) { //if no attibute we do not want to do anything\r\n\r\n      this.vGrid.element.addEventListener(\"filterUpdate\", (e)=> {\r\n        if (e.detail.attribute === this.attribute) {\r\n          this.filterOperator = e.detail.operator;\r\n          this.element.placeholder = this.vGrid.vGridFilter.filterOperatorTableString[this.filterOperator];\r\n          this.updateFilter(this.vGrid.vGridFilter.lastFilter);\r\n        }\r\n      });\r\n\r\n\r\n      this.vGrid.element.addEventListener(\"filterClearCell\", (e)=> {\r\n        if (e.detail.attribute === this.attribute) {\r\n          this.resetValue();\r\n          this.updateFilter(this.vGrid.vGridFilter.lastFilter);\r\n        }\r\n      });\r\n\r\n      this.vGrid.element.addEventListener(\"filterClearAll\", (e)=> {\r\n        this.resetValue();\r\n        this.updateFilter(this.vGrid.vGridFilter.lastFilter);\r\n      });\r\n\r\n\r\n      if (this.type !== \"checkbox\") {\r\n\r\n        this.element.placeholder = this.vGrid.vGridFilter.filterOperatorTableString[this.filterOperator];\r\n\r\n\r\n        //add eveent listner\r\n        this.element.onkeyup = (e) => {\r\n          if (e.keyCode === 13) {\r\n\r\n            //if they hit enter we need to get filter, update and run query\r\n            this.updateFilter(this.vGrid.vGridFilter.lastFilter);\r\n            this.vGrid.vGridConfig.onFilterRun(this.vGrid.vGridFilter.lastFilter);\r\n\r\n          } else {\r\n\r\n            //if they hit enter we need to get filter, update\r\n            this.updateFilter(this.vGrid.vGridFilter.lastFilter);\r\n            if (this.filterOn === \"onKeyDown\") {\r\n              this.vGrid.vGridConfig.onFilterRun(this.vGrid.vGridFilter.lastFilter);\r\n            }\r\n          }\r\n        };\r\n\r\n\r\n      } else {\r\n        //set default!\r\n        this.element.style.opacity = 0.3;\r\n        //is checkbox\r\n        this.element.onclick = (e) => {\r\n          switch (this.state) {\r\n            case 0:\r\n              this.state = 2;\r\n              this.element.style.opacity = 1;\r\n              break;\r\n            case 2:\r\n              this.state = 3;\r\n              this.element.style.opacity = 1;\r\n              break;\r\n            default:\r\n              this.element.checked = false;\r\n              this.state = 0;\r\n              this.element.style.opacity = 0.3;\r\n          }\r\n          this.updateFilter(this.vGrid.vGridFilter.lastFilter);\r\n          this.vGrid.vGridConfig.onFilterRun(this.vGrid.vGridFilter.lastFilter);\r\n        }\r\n\r\n\r\n      }\r\n    }\r\n  }\r\n}\r\n"]}