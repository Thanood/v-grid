{"version":3,"sources":["vGrid/v-grid-attributes-filter.js"],"names":[],"mappings":"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","file":"vGrid/v-grid-attributes-filter.js","sourceRoot":"/source/","sourcesContent":["/*****************************************************************************************************************\n *    Attributes for header so users can add to headers to activate filtering\n *    Created by vegar ringdal\n *\n ****************************************************************************************************************/\nimport {inject, customAttribute} from 'aurelia-framework';\nimport {VGrid} from './v-grid';\n\n\n@customAttribute('v-filter')\n@inject(Element, VGrid)\nexport class vGridAttributesFilter {\n\n  constructor(element, vGrid) {\n    this.vGrid = vGrid;\n    this.element = element;\n  }\n\n\n  get valueConverters() {\n    if (this.vGrid) {\n      return this.vGrid.viewResources.lookupFunctions.valueConverters;\n    }\n  }\n\n\n  bind(bindingContext, overrideContext) {\n    this.bindingContext = bindingContext;\n    this.overrideContext = overrideContext;\n\n    //splitt options\n    let values = this.value.split(\"|\");\n\n    //get attribute\n    this.attribute = values[0].trim();\n\n    //loop values and find out what options are\n    if (values.length > 1) {\n      values.forEach((value, i)=> {\n        if (i !== 0) {\n          this.checkParams(value);\n        }\n      });\n    }\n\n    this.filterOn = this.filterOn || \"onEnterKey\";\n    this.filterOperator = this.filterOperator || \"=\";\n    this.valueFormater = this.valueFormater || null;\n    this.type = this.element.type;\n    this.state = 0;\n\n  }\n\n\n  checkParams(value) {\n\n    if (value !== undefined && value !== null) {\n      value = value.trim();\n    }\n\n    let valueConverter = this.valueConverters(value);\n    if (valueConverter) {\n      this.valueFormater = valueConverter;\n    }\n\n    let filterOperator = this.vGrid.vGridFilter.filterOperatorTableString[value];\n    if (filterOperator) {\n      this.filterOperator = value;\n    }\n\n    if (value === \"onKeyDown\") {\n      this.filterOn = value;\n    }\n\n\n  }\n\n\n  getValue() {\n    if (this.type !== \"checkbox\") {\n      return this.valueFormater ? this.valueFormater.fromView(this.element.value) : this.element.value;\n    } else {\n      return this.state ? this.state === 2 ? true : false : \"\";\n    }\n  }\n\n\n  resetValue() {\n    if (this.type !== \"checkbox\") {\n      this.element.value = \"\";\n    } else {\n      this.state = 0;\n      this.element.checked = false;\n    }\n  }\n\n\n  updateFilter(curFilter) {\n    var filterIndex = null;\n\n    //get index of filter\n    curFilter.forEach((filter, index)=> {\n      if (filter.attribute === this.attribute) {\n        filterIndex = index;\n      }\n    });\n\n    if (filterIndex !== null) {\n\n      //we found a filter, lets update\n      if (this.getValue() === \"\") {\n        curFilter.splice(filterIndex, 1);\n      } else {\n        curFilter[filterIndex].value = this.getValue();\n        curFilter[filterIndex].operator = this.filterOperator;\n      }\n\n    } else {\n\n      //we didnt find filter, lets add one\n      if (this.getValue() !== \"\") {\n        curFilter.push({\n          attribute: this.attribute,\n          operator: this.filterOperator,\n          value: this.getValue()\n        });\n      }\n\n    }\n  }\n\n\n  attached() {\n\n    if (this.attribute) { //if no attibute we do not want to do anything\n\n      this.vGrid.element.addEventListener(\"filterUpdate\", (e)=> {\n        if (e.detail.attribute === this.attribute) {\n          this.filterOperator = e.detail.operator;\n          this.element.placeholder = this.vGrid.vGridFilter.filterOperatorTableString[this.filterOperator];\n          this.updateFilter(this.vGrid.vGridFilter.lastFilter);\n        }\n      });\n\n\n      this.vGrid.element.addEventListener(\"filterClearCell\", (e)=> {\n        if (e.detail.attribute === this.attribute) {\n          this.resetValue();\n          this.updateFilter(this.vGrid.vGridFilter.lastFilter);\n        }\n      });\n\n      this.vGrid.element.addEventListener(\"filterClearAll\", ()=> {\n        this.resetValue();\n        this.updateFilter(this.vGrid.vGridFilter.lastFilter);\n      });\n\n\n      if (this.type !== \"checkbox\") {\n\n        this.element.placeholder = this.vGrid.vGridFilter.filterOperatorTableString[this.filterOperator];\n\n\n        //add eveent listner\n        this.element.onkeyup = (e) => {\n          if (e.keyCode === 13) {\n\n            //if they hit enter we need to get filter, update and run query\n            this.updateFilter(this.vGrid.vGridFilter.lastFilter);\n            this.vGrid.vGridConfig.onFilterRun(this.vGrid.vGridFilter.lastFilter);\n\n          } else {\n\n            //if they hit enter we need to get filter, update\n            this.updateFilter(this.vGrid.vGridFilter.lastFilter);\n            if (this.filterOn === \"onKeyDown\") {\n              this.vGrid.vGridConfig.onFilterRun(this.vGrid.vGridFilter.lastFilter);\n            }\n          }\n        };\n\n\n      } else {\n        //set default!\n        this.element.style.opacity = 0.3;\n        //is checkbox\n        this.element.onclick = (e) => {\n          switch (this.state) {\n            case 0:\n              this.state = 2;\n              this.element.style.opacity = 1;\n              break;\n            case 2:\n              this.state = 3;\n              this.element.style.opacity = 1;\n              break;\n            default:\n              this.element.checked = false;\n              this.state = 0;\n              this.element.style.opacity = 0.3;\n          }\n          this.updateFilter(this.vGrid.vGridFilter.lastFilter);\n          this.vGrid.vGridConfig.onFilterRun(this.vGrid.vGridFilter.lastFilter);\n        }\n\n\n      }\n    }\n  }\n}\n"]}