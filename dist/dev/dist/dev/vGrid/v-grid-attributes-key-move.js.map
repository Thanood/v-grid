{"version":3,"sources":["vGrid/v-grid-attributes-key-move.js"],"names":[],"mappings":"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","file":"vGrid/v-grid-attributes-key-move.js","sourceRoot":"/source/","sourcesContent":["/*****************************************************************************************************************\n *    Attributes for tabbing, keyup/down and page up/down\n *    Created by vegar ringdal\n *\n ****************************************************************************************************************/\nimport {inject, customAttribute} from 'aurelia-framework';\nimport {VGrid} from './v-grid';\n\n\n@customAttribute('v-key-move')\n@inject(Element, VGrid)\nexport class vGridAttributesKeyMove {\n\n\n  constructor(element, vGrid) {\n    this.vGrid = vGrid;\n    this.element = element;\n    this.classname = \"v-grid-key-move\";\n  }\n\n\n  bind(bindingContext, overrideContext) {\n    this.bindingContext = bindingContext;\n    this.overrideContext = overrideContext;\n\n  }\n\n\n  attached() {\n    this.element.classList.add(this.classname);\n    this.addGridKeyListner();\n\n    this.element.addEventListener('tabbing', (e)=> {\n      this.element.focus();\n\n      let ev = document.createEvent('Event');\n      ev.initEvent(\"click\", true, true);\n      this.element.offsetParent.dispatchEvent(ev);\n\n    });\n\n\n    this.element.addEventListener('focus', ()=> {\n\n      if (this.vGrid.vGridCurrentEntityRef === null) {\n        let ev = document.createEvent('Event');\n        ev.initEvent(\"click\", true, true);\n        this.element.offsetParent.dispatchEvent(ev);\n      }\n\n\n\n\n    });\n\n  }\n\n\n  /***************************************************************************************\n   * for setting next cell ny similating a mouse click, used for tabbing etc\n   ***************************************************************************************/\n  dispatchCellClick(index) {\n    var e = document.createEvent('Event');\n    e.initEvent(\"tabbing\", true, true);\n\n    if (this.cells[index]) {\n      this.cells[index].dispatchEvent(e);\n    }\n  }\n\n\n  /***************************************************************************************\n   * sets \"the cells\" from  to direction asked for, so tabbing jumps to next row\n   ***************************************************************************************/\n  setCellsFromElement(node, direction) {\n    var thisTop;\n    var element;\n    for (var i = 0; i < 10; i++) {\n      try {\n        if (node.classList.contains(this.vGrid.vGridConfig.css.row)) {\n          var row = parseInt(node.getAttribute(\"row\"));\n          for (var y = 0; y < this.vGrid.vGridGenerator.rowElementArray.length; y++) {\n            if (row === parseInt((this.vGrid.vGridGenerator.rowElementArray[y].top / this.vGrid.vGridConfig.attRowHeight))) {\n              this.row = row;\n              thisTop = this.vGrid.vGridGenerator.rowElementArray[y + direction].top;\n              element = this.vGrid.vGridGenerator.rowElementArray[y + direction].div;\n            }\n          }\n        }\n        node = node.parentNode;\n      } catch (err) {\n        //nothing for now\n      }\n    }\n    if (element) {\n      this.cells = element.querySelectorAll(\".\" + this.classname);\n    }\n    return thisTop;\n  }\n\n\n  /***************************************************************************************\n   * sets \"the cells\" from a top value, used for page up/down\n   ***************************************************************************************/\n  setCellsFromTopValue(top) {\n    var element = 0;\n    for (var i = 0; i < this.vGrid.vGridGenerator.rowElementArray.length; i++) {\n      if (this.vGrid.vGridGenerator.rowElementArray[i].top === top) {\n        element = this.vGrid.vGridGenerator.rowElementArray[i].div;\n      }\n    }\n    if (element) {\n      this.cells = element.querySelectorAll(\".\" + this.classname);\n    }\n\n  }\n\n\n  /***************************************************************************************\n   * simple delay for the keydown events, like tabbing etc, so I cantrol the speed of it\n   ***************************************************************************************/\n  keyDownDelay(callback) {\n    if (!this.timer) {\n      this.timer = setTimeout(()=> {\n        this.timer = null;\n        callback();\n      }, 150);\n    }\n  }\n\n\n  /***************************************************************************************\n   * get the index\n   ***************************************************************************************/\n  getIndex() {\n    for (var i = 0; i < this.cells.length; i++) {\n      if (this.element === this.cells[i]) {\n        this.index = i;\n        if (i === 0) {\n          this.first = true;\n        } else {\n          this.first = false;\n        }\n        if (i === this.cells.length - 1) {\n          this.last = true;\n        } else {\n          this.last = false;\n        }\n\n      }\n    }\n  }\n\n\n  /***************************************************************************************\n   * adds main keys, like arrow keys, tab, and page up/down\n   ***************************************************************************************/\n  addGridKeyListner() {\n\n\n    this.element.onkeydown = (e) => {\n\n\n      this.setCellsFromElement(this.element, 0);\n      this.getIndex();\n\n\n      //page up\n      if (e.keyCode === 33) {\n        e.preventDefault();\n        this.keyDownDelay(() => {\n\n\n         //get content height/rows\n          var rowHeight = this.vGrid.vGridConfig.attRowHeight;\n          var containerHeight = this.vGrid.vGridGenerator.contentElement.clientHeight;\n          var containerRows = parseInt(containerHeight / rowHeight, 10);\n          this.top = this.setCellsFromElement(this.element, 0);\n\n          var newTop = this.top - (containerRows * rowHeight);\n          if ((newTop / rowHeight) <= 0) {\n            newTop = 0;\n          }\n\n\n          //if last scroll was up then we need to reverse the buffer\n          if (this.vGrid.vGridScrollEvents.lastScrollType === \"down\") {\n            this.vGrid.vGridScrollEvents.onSmallScroll(false);\n          }\n\n          this.setCellsFromTopValue(newTop);\n          this.dispatchCellClick(this.index);\n\n          var setTop = newTop - parseInt((containerRows * rowHeight) / 2);\n          this.vGrid.vGridClientCtx.setScrollTop(setTop);\n\n\n        });\n      }\n\n\n      //page down\n      if (e.keyCode === 34) {\n        e.preventDefault();\n        this.keyDownDelay(() => {\n\n\n          //get scrolltop\n          var currentscrolltop = this.vGrid.vGridClientCtx.getScrollTop();\n\n          //get content height/rows\n          var rowHeight = this.vGrid.vGridConfig.attRowHeight;\n          var containerHeight = this.vGrid.vGridGenerator.contentElement.clientHeight;\n          var containerRows = parseInt(containerHeight / rowHeight, 10);\n          this.top = this.setCellsFromElement(this.element, 0);\n\n          var newTop = this.top + (containerRows * rowHeight);\n          if ((newTop / rowHeight) >= this.vGrid.vGridConfig.getCollectionLength()) {\n            newTop = this.vGrid.vGridConfig.getCollectionLength() * rowHeight;\n            newTop = newTop - rowHeight\n          }\n\n          //if last scroll was up then we need to reverse the buffer\n          if (this.vGrid.vGridScrollEvents.lastScrollType === \"up\") {\n            this.vGrid.vGridScrollEvents.onSmallScroll(true);\n          }\n\n          this.setCellsFromTopValue(newTop);\n          this.dispatchCellClick(this.index);\n\n          var setTop = newTop - parseInt((containerRows * rowHeight) / 2);\n          this.vGrid.vGridClientCtx.setScrollTop(setTop);\n        });\n      }\n\n      //arrow down\n      if (e.keyCode === 40) {\n        e.preventDefault();\n        this.keyDownDelay(() => {\n          if (this.vGrid.vGridScrollEvents.lastScrollType === \"up\") {\n            this.vGrid.vGridScrollEvents.onSmallScroll(true);\n          }\n          this.top = this.setCellsFromElement(this.element, +1);\n          this.dispatchCellClick(this.index)\n        });\n      }\n\n\n      //arrow up\n      if (e.keyCode === 38) {\n        e.preventDefault();\n        this.keyDownDelay(() => {\n          if (this.vGrid.vGridScrollEvents.lastScrollType === \"down\") {\n            this.vGrid.vGridScrollEvents.onSmallScroll(false);\n          }\n          this.top = this.setCellsFromElement(this.element, -1);\n          this.dispatchCellClick(this.index)\n        });\n      }\n\n\n      //tab and shift key for tabing in other direction\n      if (e.keyCode === 9 && e.shiftKey === true) {\n        if (this.row !== 0 && this.first) {\n          e.preventDefault();\n          this.keyDownDelay(() => {\n            this.index = this.index - 1;\n            if (this.first) {\n              if (this.vGrid.vGridScrollEvents.lastScrollType === \"down\") {\n                this.vGrid.vGridScrollEvents.onSmallScroll(false);\n              }\n              this.index = this.cells.length - 1;\n              this.top = this.setCellsFromElement(this.element, -1)\n            }\n            this.dispatchCellClick(this.index)\n\n          });\n        }\n      }\n\n\n      //normal tabbing\n      if (e.keyCode === 9 && e.shiftKey === false) {\n\n\n        e.preventDefault();\n        this.keyDownDelay(() => {\n          this.index = this.index + 1;\n          if (this.last) {\n            if (this.vGrid.vGridScrollEvents.lastScrollType === \"up\") {\n              this.vGrid.vGridScrollEvents.onSmallScroll(true);\n            }\n            this.index = 0;\n            this.top = this.setCellsFromElement(this.element, 1)\n          }\n          this.dispatchCellClick(this.index)\n        });\n\n      }\n\n    }\n  }\n\n\n}\n"]}