{"version":3,"sources":["vGrid/v-grid.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAOQ,e,qBAAA,S;AAAW,mB,qBAAA,a;AAAe,c,qBAAA,Q;AAAU,kB,qBAAA,Y;AAAc,c,qBAAA,Q;AAAU,e,qBAAA,S;AAAW,mB,qBAAA,a;AAAe,mB,qBAAA,a;;AAGtF,oB,mBAAA,c;;AACA,iB,gBAAA,W;;AACA,e,cAAA,S;;AACA,sB,qBAAA,gB;;AACA,iB,gBAAA,W;;AACA,oB,mBAAA,c;;AACA,c,aAAA,Q;;AACA,uB,sBAAA,iB;;AACA,0B,yBAAA,oB;;;uBAGK,K,WAEV,SAAS,EAAC,WAAW,gBAAZ,EAAT,C,UACA,SAAS,EAAC,WAAW,cAAZ,EAAT,C,UACA,SAAS,EAAC,WAAW,kBAAZ,EAAT,C,UACA,SAAS,EAAC,WAAW,WAAZ,EAAT,C,UACA,SAAS,EAAC,WAAW,cAAZ,EAAT,C,UACA,SAAS,EAAC,WAAW,iBAAZ,EAAT,C,UACA,SAAS,EAAC,WAAW,iBAAZ,EAAT,C,UACA,SAAS,EAAC,WAAW,gBAAZ,EAAT,C,UACA,SAAS,EAAC,WAAW,cAAZ,EAAT,C,WACA,SAAS,EAAC,WAAW,qBAAZ,EAAT,C,WACA,SAAS,EAAC,WAAW,gBAAZ,EAAT,C,WACA,SAAS,EAAC,WAAW,eAAZ,EAAT,C,WACA,SAAS,EAAC,WAAW,kBAAZ,EAAT,C,WACA,SAAS,EAAC,WAAW,mBAAZ,EAAT,C,WACA,SAAS,EAAC,WAAW,gBAAZ,EAAT,C,WACA,SAAS,EAAC,WAAW,YAAZ,EAAT,C;AAID,uBAAY,OAAZ,EAAqB,aAArB,EAAoC,YAApC,EAAkD,QAAlD,EAA4D,SAA5D,EAAuE,aAAvE,EAAsF,SAAtF,EAAiG;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA,eAFjG,OAEiG,GAFvF,KAEuF;;AAG/F,eAAK,OAAL,GAAe,OAAf;;AAGA,eAAK,YAAL,GAAoB,YAApB;AACA,eAAK,QAAL,GAAgB,QAAhB;AACA,eAAK,SAAL,GAAiB,SAAjB;AACA,eAAK,aAAL,GAAqB,aAArB;AACA,eAAK,SAAL,GAAiB,SAAjB;;AAGA,eAAK,qBAAL,GAA6B,IAA7B;;AAGA,eAAK,eAAL,GAAuB,CAAC,CAAxB;;AAGA,eAAK,WAAL,GAAmB,YAAnB;;AAGA,eAAK,uBAAL,GAA+B,EAA/B;;AAGA,eAAK,iBAAL,GAAyB,IAAI,iBAAJ,CAAsB,IAAtB,CAAzB;AACA,eAAK,WAAL,GAAmB,IAAI,WAAJ,CAAgB,IAAhB,CAAnB;AACA,eAAK,SAAL,GAAiB,IAAI,SAAJ,CAAc,IAAd,CAAjB;AACA,eAAK,WAAL,GAAmB,IAAI,WAAJ,CAAgB,IAAhB,CAAnB;AACA,eAAK,cAAL,GAAsB,IAAI,cAAJ,CAAmB,IAAnB,EAAyB,IAAzB,CAAtB;AACA,eAAK,gBAAL,GAAwB,IAAI,gBAAJ,CAAqB,IAArB,EAA2B,aAA3B,CAAxB;AACA,eAAK,cAAL,GAAsB,IAAI,cAAJ,CAAmB,IAAnB,CAAtB;AACA,eAAK,cAAL,GAAsB,IAAI,QAAJ,CAAa,IAAb,CAAtB;AACA,eAAK,oBAAL,GAA4B,IAAI,oBAAJ,CAAyB,IAAzB,CAA5B;AACA,eAAK,UAAL,GAAkB,IAAlB;AAIA,eAAK,oBAAL;AACA,eAAK,gBAAL;AACA,eAAK,mBAAL;AAED;;wBAMD,U,uBAAW,I,EAAiB;AAAA,cAAX,IAAW,yDAAJ,EAAI;;AAC1B,cAAI,QAAQ,IAAI,WAAJ,CAAgB,IAAhB,EAAsB;AAChC,oBAAQ,IADwB;AAEhC,qBAAS;AAFuB,WAAtB,CAAZ;AAIA,eAAK,OAAL,CAAa,aAAb,CAA2B,KAA3B;;AAEA,iBAAO,KAAP;AACD,S;;wBAID,mB,kCAAqB;;AAEnB,cAAI,KAAK,KAAK,oBAAd;AACA,cAAI,KAAK,KAAK,gBAAd;AACA,cAAI,KAAK,KAAK,mBAAd;AACA,cAAI,KAAK,KAAK,eAAL,CAAqB,MAA9B;AACA,cAAI,KAAK,KAAK,uBAAL,CAA6B,MAAtC;AACA,cAAI,KAAK,KAAK,cAAL,CAAoB,YAA7B;;AAEA,cAAG,OAAO,EAAP,IAAa,OAAO,EAApB,IAA0B,OAAO,EAApC,EAAuC;AAGrC,iBAAK,UAAL,CAAgB,0BAAhB,EAA4C;AAC1C,mBAAK,0BADqC;AAE1C,2BAAa,KAAK,eAAL,CAAqB,MAFQ;AAG1C,4BAAe,KAAK,uBAAL,CAA6B,MAHF;AAI1C,+BAAgB,KAAK,cAAL,CAAoB;AAJM,aAA5C;;AAQA,iBAAK,oBAAL,GAA4B,KAAK,eAAL,CAAqB,MAAjD;AACA,iBAAK,gBAAL,GAAwB,KAAK,uBAAL,CAA6B,MAArD;AACA,iBAAK,mBAAL,GAA2B,KAAK,cAAL,CAAoB,YAA/C;AACD;AAKF,S;;wBAQD,S,wBAAY;AAAA;;AAEV,eAAK,eAAL,CAAqB,OAArB,CAA6B,UAAC,GAAD,EAAS;AACpC,gBAAG,CAAC,IAAI,MAAK,WAAT,CAAD,IAA0B,QAAQ,SAAlC,IAA+C,QAAQ,IAA1D,EAA+D;AAC7D,kBAAI,MAAK,WAAT,IAAuB,MAAK,IAAL,EAAvB;AACD;AACF,WAJD;AAKD,S;;wBAED,Q,qBAAS,G,EAAK;AACV,cAAG,CAAC,IAAI,KAAK,WAAT,CAAD,IAA0B,QAAQ,SAAlC,IAA+C,QAAQ,IAA1D,EAA+D;AAC7D,gBAAI,KAAK,WAAT,IAAuB,KAAK,IAAL,EAAvB;AACD;AACJ,S;;wBAED,c,2BAAe,G,EAAI;AAAA;;AACjB,cAAI,WAAW,IAAf;AACA,eAAK,eAAL,CAAqB,OAArB,CAA6B,UAAC,GAAD,EAAM,KAAN,EAAgB;AAC3C,gBAAG,IAAI,OAAK,WAAT,MAA0B,GAA7B,EAAiC;AAC/B,yBAAW,KAAX;AACD;AACF,WAJD;AAKA,iBAAO,QAAP;AACD,S;;wBAED,I,mBAAO;AACL,mBAAS,EAAT,GAAc;AACZ,mBAAO,KAAK,KAAL,CAAW,CAAC,IAAI,KAAK,MAAL,EAAL,IAAsB,OAAjC,EACJ,QADI,CACK,EADL,EAEJ,SAFI,CAEM,CAFN,CAAP;AAGD;AACD,iBAAO,OAAO,IAAP,GAAc,GAAd,GAAoB,IAApB,GAA2B,GAA3B,GAAiC,IAAjC,GAAwC,GAAxC,GACL,IADK,GACE,GADF,GACQ,IADR,GACe,IADf,GACsB,IAD7B;AAED,S;;wBAOD,I,iBAAK,M,EAAQ,e,EAAiB;AAI5B,eAAK,OAAL,GAAe,MAAf;AACA,eAAK,eAAL,GAAuB,eAAvB;;AAIA,cAAI,CAAC,KAAK,eAAV,EAA2B;AACzB,iBAAK,eAAL,GAAuB,EAAvB;AACD;;AAGD,eAAK,eAAL,CAAqB,GAArB,GAA2B,KAAK,cAAhC;AACA,cAAI,UAAU,KAAK,WAAnB;AACA,kBAAQ,iBAAR,CAA0B,KAAK,mBAA/B,EAAoD,qBAApD;AACA,kBAAQ,eAAR,CAAwB,KAAK,YAA7B,EAA2C,cAA3C;AACA,kBAAQ,eAAR,CAAwB,KAAK,eAA7B,EAA8C,iBAA9C;AACA,kBAAQ,eAAR,CAAwB,KAAK,eAA7B,EAA8C,iBAA9C;AACA,kBAAQ,gBAAR,CAAyB,KAAK,mBAA9B,EAAmD,qBAAnD;AACA,kBAAQ,gBAAR,CAAyB,KAAK,cAA9B,EAA8C,gBAA9C;AACA,kBAAQ,gBAAR,CAAyB,KAAK,iBAA9B,EAAiD,mBAAjD;AACA,kBAAQ,eAAR,CAAwB,KAAK,mBAA7B,EAAkD,qBAAlD;AACA,kBAAQ,kBAAR,CAA2B,KAAK,cAAhC,EAAgD,gBAAhD;AACA,kBAAQ,gBAAR,CAAyB,KAAK,kBAA9B,EAAkD,oBAAlD;AACA,kBAAQ,oBAAR,CAA6B,KAAK,cAAlC,EAAkD,gBAAlD;AACA,kBAAQ,oBAAR,CAA6B,KAAK,iBAAlC,EAAqD,mBAArD;AACA,kBAAQ,gBAAR,CAAyB,KAAK,gBAA9B,EAAgD,kBAAhD;AACA,kBAAQ,kBAAR,CAA2B,KAAK,cAAhC,EAAgD,gBAAhD;AACA,eAAK,WAAL,CAAiB,WAAjB,GAA+B,KAAK,WAAL,IAAoB,KAAK,WAAL,CAAiB,WAApE;;AAMA,cAAI,KAAK,eAAL,KAAyB,SAAzB,IAAsC,KAAK,kBAAL,KAA4B,SAAtE,EAAiF;AAC/E,gBAAI,KAAK,eAAL,KAAyB,SAAzB,IAAsC,KAAK,kBAAL,KAA4B,SAAtE,EAAiF;AAC/E,sBAAQ,IAAR,CAAa,+DAAb;AACD,aAFD,MAEO;AACL,kBAAI,KAAK,kBAAL,KAA4B,SAAhC,EAA2C;AACzC,wBAAQ,IAAR,CAAa,kDAAb;AACD;AACD,kBAAI,KAAK,eAAL,KAAyB,SAA7B,EAAwC;AACtC,wBAAQ,IAAR,CAAa,+CAAb;AACD;AACF;AACF,WAXD,MAWO;AAEL,iBAAK,uBAAL,GAA+B,KAAK,eAAL,CAAqB,KAArB,CAA2B,CAA3B,CAA/B;;AAEA,iBAAK,SAAL;AACD;AACF,S;;wBAMD,Q,uBAAW;;AAET,cAAG,CAAC,KAAK,WAAL,CAAiB,QAArB,EAA8B;AAC5B,iBAAK,oBAAL,CAA0B,QAA1B;AACD;;AAGD,eAAK,gBAAL,CAAsB,2BAAtB;AACA,eAAK,gBAAL,CAAsB,sBAAtB;AACA,eAAK,gBAAL,CAAsB,2BAAtB;;AAGA,eAAK,cAAL,CAAoB,IAApB,CAAyB,KAAzB;AAED,S;;wBAGD,M,qBAAQ;AACN,eAAK,cAAL,CAAoB,qBAApB;AACD,S;;wBAMD,Q,uBAAW;AACT,eAAK,gBAAL,CAAsB,4BAAtB;AACA,eAAK,gBAAL,CAAsB,4BAAtB;AACA,eAAK,gBAAL,CAAsB,uBAAtB;AACD,S;;;mBApPM,M,GAAS,CAAC,OAAD,EAAU,aAAV,EAAyB,YAAzB,EAAuC,QAAvC,EAAiD,SAAjD,EAA4D,aAA5D,EAA2E,SAA3E,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;yFAiBf,Q;;;iBAA0B,qB","file":"vGrid/v-grid.js","sourceRoot":"/source/","sourcesContent":["/*****************************************************************************************************************\n *    vGrid\n *    This is the custom aurelia element\n *    Prb doing al kinds of wrong in here, will improve as I learn more\n *    Created by vegar ringdal\n *\n ****************************************************************************************************************/\nimport {TaskQueue, BindingEngine, bindable, ViewCompiler, ViewSlot, Container, ViewResources, containerless} from 'aurelia-framework';\n\n\nimport {VGridGenerator} from './v-grid-generator';\nimport {VGridFilter} from './v-grid-filter';\nimport {VGridSort} from './v-grid-sort';\nimport {VGridObservables} from './v-grid-observables';\nimport {VGridConfig} from './v-grid-config';\nimport {VGridSelection} from './v-grid-selection';\nimport {VGridCtx} from './v-grid-ctx';\nimport {VGridScrollEvents} from './v-grid-scroll-events';\nimport {VGridMarkupGenerator} from './v-grid-markup-generator';\n\n\nexport class VGrid {\n  static inject = [Element, BindingEngine, ViewCompiler, ViewSlot, Container, ViewResources, TaskQueue];\n  @bindable({attribute: \"v-grid-context\"}) vGridContextObj;\n  @bindable({attribute: \"v-collection\"}) vGridCollection;\n  @bindable({attribute: \"v-current-entity\"}) vGridCurrentEntity;\n  @bindable({attribute: \"v-columns\"}) vGridColumns;\n  @bindable({attribute: \"v-row-height\"}) attRowHeight;\n  @bindable({attribute: \"v-header-height\"}) attHeaderHeight;\n  @bindable({attribute: \"v-footer-height\"}) attFooterHeight;\n  @bindable({attribute: \"v-multi-select\"}) attMultiSelect;\n  @bindable({attribute: \"v-manual-sel\"}) attManualSelection;\n  @bindable({attribute: \"v-loading-threshold\"}) attLoadingThreshold;\n  @bindable({attribute: \"v-remote-index\"}) attRemoteIndex;\n  @bindable({attribute: \"v-row-on-draw\"}) eventOnRowDraw;\n  @bindable({attribute: \"v-event-onremote\"}) eventOnRemoteCall;\n  @bindable({attribute: \"v-hide-pager-info\"}) attHidePagerInfo;\n  @bindable({attribute: \"v-custom-pager\"}) attCustomPager;\n  @bindable({attribute: \"v-language\"}) attLanguage;\n  @bindable loadingMessage = \"Working please wait\";\n  loading = false;\n\n  constructor(element, bindingEngine, viewCompiler, viewSlot, container, viewResources, taskQueue) {\n\n    //<v-grid> element\n    this.element = element;\n\n    //aurelia stuff I need for creating my cells etc\n    this.viewCompiler = viewCompiler;\n    this.viewSlot = viewSlot;\n    this.container = container;\n    this.viewResources = viewResources;\n    this.taskQueue = taskQueue;\n\n    //keeps the current entity ref\n    this.vGridCurrentEntityRef = null;\n\n    //current selected row in grid, not always the same as collection when used filter/sorting\n    this.vGridCurrentRow = -1;\n\n    //key name, used for knowing what record in filtered collection belongs to main collection\n    this.vGridRowKey = \"__vGridKey\";\n\n    //cloned collection used internaly for everything, I never sort the original collection\n    this.vGridCollectionFiltered = [];\n\n    //my classes the grid uses\n    this.vGridScrollEvents = new VGridScrollEvents(this);\n    this.vGridFilter = new VGridFilter(this);\n    this.vGridSort = new VGridSort(this);\n    this.vGridConfig = new VGridConfig(this);\n    this.vGridSelection = new VGridSelection(null, this);\n    this.vGridObservables = new VGridObservables(this, bindingEngine);\n    this.vGridGenerator = new VGridGenerator(this);\n    this.vGridClientCtx = new VGridCtx(this);\n    this.vGridMarkupGenerator = new VGridMarkupGenerator(this);\n    this.vGridPager = null; //set by pager\n\n\n    //vars\n    this.lastCollectionLength;\n    this.lastFilterLength;\n    this.lastSelectionLength;\n\n  }\n\n  /***************************************************************************************\n   * event dispatcher\n   ***************************************************************************************/\n\n  raiseEvent(name, data = {}) {\n    let event = new CustomEvent(name, {\n      detail: data,\n      bubbles: true\n    });\n    this.element.dispatchEvent(event);\n\n    return event;\n  }\n\n\n  //sends out event that total/filtered or selection have changed\n  sendCollectionEvent(){\n\n    let x1 = this.lastCollectionLength;\n    let x2 = this.lastFilterLength;\n    let x3 = this.lastSelectionLength;\n    let y1 = this.vGridCollection.length;\n    let y2 = this.vGridCollectionFiltered.length;\n    let y3 = this.vGridSelection.selectedRows;\n\n    if(x1 !== y1 || x2 !== y2 || x3 !== y3){\n\n      //send out event\n      this.raiseEvent(\"v-local-collection-event\", {\n        evt: \"v-local-collection-event\",\n        totalLength: this.vGridCollection.length,\n        filterLength : this.vGridCollectionFiltered.length,\n        selectionLength:this.vGridSelection.selectedRows\n      });\n\n      //set new values\n      this.lastCollectionLength = this.vGridCollection.length;\n      this.lastFilterLength = this.vGridCollectionFiltered.length;\n      this.lastSelectionLength = this.vGridSelection.selectedRows;\n    }\n\n\n\n\n  }\n\n\n\n  /***************************************************************************************\n   * resets internal key on vGridCollection/internal vGridCollectionFiltered\n   ***************************************************************************************/\n\n  checkKeys() {\n   // let key = 0; //reset it\n    this.vGridCollection.forEach((row) => {\n      if(!row[this.vGridRowKey] && row !== undefined && row !== null){\n        row[this.vGridRowKey]= this.guid();\n      }\n    });\n  }\n\n  checkKey(row) {\n      if(!row[this.vGridRowKey] && row !== undefined && row !== null){\n        row[this.vGridRowKey]= this.guid();\n      }\n  }\n\n  vGridGetRowKey(key){\n    var rowFound = null;\n    this.vGridCollection.forEach((row, index) => {\n      if(row[this.vGridRowKey] === key){\n        rowFound = index;\n      }\n    });\n    return rowFound\n  }\n\n  guid() {\n    function s4() {\n      return Math.floor((1 + Math.random()) * 0x10000)\n        .toString(16)\n        .substring(1);\n    }\n    return s4() + s4() + '-' + s4() + '-' + s4() + '-' +\n      s4() + '-' + s4() + s4() + s4();\n  }\n\n\n\n  /***************************************************************************************\n   * when view is bounded\n   ***************************************************************************************/\n  bind(parent, overrideContext) {\n\n\n    //parent\n    this.$parent = parent;\n    this.overrideContext = overrideContext;\n\n    //if they havent binded a context, then lets make one.\n    //that context they will be able to trigger event on the grid\n    if (!this.vGridContextObj) {\n      this.vGridContextObj = {};\n    }\n\n    //set vgrid attibutes to our config/utillity class\n    this.vGridContextObj.ctx = this.vGridClientCtx;\n    var vConfig = this.vGridConfig;\n    vConfig.setBindValueArray(this.attAttributeObserve, 'attAttributeObserve');\n    vConfig.setBindValueInt(this.attRowHeight, 'attRowHeight');\n    vConfig.setBindValueInt(this.attHeaderHeight, 'attHeaderHeight');\n    vConfig.setBindValueInt(this.attFooterHeight, 'attFooterHeight');\n    vConfig.setBindValueBool(this.attResizableHeaders, 'attResizableHeaders');\n    vConfig.setBindValueBool(this.attMultiSelect, 'attMultiSelect');\n    vConfig.setBindValueBool(this.attSortableHeader, 'attSortableHeader');\n    vConfig.setBindValueInt(this.attLoadingThreshold, 'attLoadingThreshold');\n    vConfig.setBindValueString(this.attRemoteIndex, 'attRemoteIndex');\n    vConfig.setBindValueBool(this.attManualSelection, 'attManualSelection');\n    vConfig.setBindValueFunction(this.eventOnRowDraw, 'eventOnRowDraw');\n    vConfig.setBindValueFunction(this.eventOnRemoteCall, 'eventOnRemoteCall');\n    vConfig.setBindValueBool(this.attHidePagerInfo, 'attHidePagerInfo');\n    vConfig.setBindValueString(this.attCustomPager, 'attCustomPager');\n    this.vGridConfig.attLanguage = this.attLanguage || this.vGridConfig.attLanguage;\n\n    \n\n\n    //lets test that they have set the mandatory config settings\n    if (this.vGridCollection === undefined || this.vGridCurrentEntity === undefined) {\n      if (this.vGridCollection === undefined && this.vGridCurrentEntity === undefined) {\n        console.warn(\"currentEntity & collection not set/binded in config attribute\");\n      } else {\n        if (this.vGridCurrentEntity === undefined) {\n          console.warn(\"currentEntity not set/binded in config attribute\");\n        }\n        if (this.vGridCollection === undefined) {\n          console.warn(\"collection not set/binded in config attribute\");\n        }\n      }\n    } else {\n      //clone collection and add key index, so we know it.\n      this.vGridCollectionFiltered = this.vGridCollection.slice(0);\n      //resets the keys\n      this.checkKeys();\n    }\n  }\n\n\n  /***************************************************************************************\n   * set all options\n   ***************************************************************************************/\n  attached() {\n\n    if(!this.vGridConfig.repeater){\n      this.vGridMarkupGenerator.generate();\n    }\n\n    //set observables\n    this.vGridObservables.enableObservablesCollection();\n    this.vGridObservables.enableObservablesArray();\n    this.vGridObservables.enableObservablesAttributes();\n\n    //create the grid html/add events etc\n    this.vGridGenerator.init(false);\n\n  }\n\n\n  unbind(){\n    this.vGridGenerator.unbindDetachViewSlots();\n  }\n\n\n  /***************************************************************************************\n   * unsubscribe property and array observers\n   ***************************************************************************************/\n  detached() {\n    this.vGridObservables.disableObservablesAttributes();\n    this.vGridObservables.disableObservablesCollection();\n    this.vGridObservables.disableObservablesArray();\n  }\n}\n"]}